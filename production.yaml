version: "3.4"

services:
  reverse-proxy:
    depends_on:
      - nuxt
      - cms
      - adminer
      - mysql
    build:
      context: ./reverse-proxy
      network: host
      args:
        - CERTBOT_EMAIL=pietro@gavillet-cie.com
        - DOMAIN_LIST=pplex-beta.gavillet-cie.com,www.pplex-beta.gavillet-cie.com,pplex.gavillet-cie.com,www.pplex.gavillet-cie.com
    ports:
      - 80:8080
      - 443:443
    restart: on-failure
    volumes:
      - letsencrypt:/etc/letsencrypt

  nuxt:
    image: ghcr.io/ptrrr/pplex-client:main
    restart: on-failure

  cms:
    image: ghcr.io/ptrrr/pplex-api:main
    volumes:
      - ./backend/site/assets:/var/www/html/api/site/assets
    restart: on-failure

  mysql:
    environment:
      MYSQL_ROOT_PASSWORD: GiBs9EFRrXyNfMmmQ4T7vH
    image: mariadb
    restart: on-failure

  adminer:
    image: adminer
    restart: on-failure

volumes:
  letsencrypt:
